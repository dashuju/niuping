document.domain = "qq.com";
var v201405231053;
(function(a, g, f) {
    function k(a) {
        return a
    }

    function m(a) {
        return decodeURIComponent(a.replace(n, " "))
    }
    var n = /\+/g,
        c = a.cookie = function(b, d, e) {
            if (d !== f) {
                e = a.extend({}, c.defaults, e);
                null === d && (e.expires = -1);
                if ("number" === typeof e.expires) {
                    var h = e.expires,
                        l = e.expires = new Date;
                    l.setDate(l.getDate() + h)
                }
                d = c.json ? JSON.stringify(d) : String(d);
                return g.cookie = [encodeURIComponent(b), "=", c.raw ? d : encodeURIComponent(d), e.expires ? "; expires=" + e.expires.toUTCString() : "", e.path ? "; path=" + e.path : "", e.domain ? "; domain=" +
                    e.domain : "", e.secure ? "; secure" : ""
                ].join("")
            }
            d = c.raw ? k : m;
            e = g.cookie.split("; ");
            for (h = 0; l = e[h] && e[h].split("="); h++)
                if (d(l.shift()) === b) return b = d(l.join("=")), c.json ? JSON.parse(b) : b;
            return null
        };
    c.defaults = {
        domain: "qq.com",
        path: "/",
        expires: 7
    };
    a.removeCookie = function(c, d) {
        return null !== a.cookie(c) ? (a.cookie(c, null, d), !0) : !1
    }
})(jQuery, document);
(function(a) {
    a.getUrlParam = function(a) {
        a = new RegExp("(^|&)" + a + "=([^&]*)(&|$)");
        a = window.location.search.substr(1).match(a);
        return null != a ? unescape(a[2]) : null
    }
})(jQuery);
"undefined" != typeof $ && $.noConflict && "object" != typeof jQuery && $.noConflict();
jQuery(document).ready(function() {
    (function(a) {
        var g = a(document);
        a(parent.document);
        var f = a(window),
            k = a("body"),
            m = null,
            n = (location.protocol + "//" + location.host + location.pathname).match(/https?:\/\/([^\.]+)/)[1];
        a.widget("qq.comment", {
            options: {
                dataSource0: "",
                $content: a("#content"),
                $loginTrigger: a("#onekey"),
                $logoutTrigger: a("#loginOut"),
                loginEvent: "logined",
                $topReply: a("#top_reply"),
                $topContent: a("#top_content"),
                $popContent: a("#pop_content"),
                $allComments: a("#allComments"),
                $postBtns: a("#top_post_btn,#pop_post_btn"),
                $loadMore: a("#loadMore"),
                toggleEvent: "toggle",
                fetchUrl: "http://coral.qq.com/",
                wfetchUrl: "http://w.coral.qq.com/",
                popCallback: "parent.popCallback",
                reportCallback: "parent.reportCallback",
                upCallback: "parent.upCallback",
                $popObj: a("#popObj"),
                $loginFlag: a("#wraper"),
                $realtimeComments: 0,
                $insertFlag: "comment",
                $nowDate: new Date,
                $urlapi: {
                    userId: 0,
                    first: "",
                    last: "",
                    msgid: "",
                    pageflag: 0
                },
                $urlapi_mycomment: {
                    userId: 0,
                    first: "",
                    last: "",
                    msgid: "",
                    pageflag: 0
                },
                $urlapi_userComment: {
                    userId: 0,
                    first: "",
                    last: "",
                    msgid: "",
                    pageflag: 0
                },
                loginuin: 0,
                pubSucEvent: "commentpubsuccess",
                topContentTips: "",
                homePageSize: 10,
                centerPageSize: 10,
                loadPageSize: 20,
                newsNum: 0,
                columSource: 1,
                columCode: 1,
                columApi: 1,
                columLink: 1,
                columHot: 1,
                commentNumbers: "",
                centerFlag: 0,
                changeFlag: 0,
                reportId: "",
                hotPageSize: 10,
                order: "",
                upId: "",
                lastId: 0,
                timer: "",
                imgNum: 0,
                targetNum: 0,
                scrollFlag: 1,
                noImg: a.getUrlParam("noimg") || 0
            },
            _create: function() {
                var a = this;
                this.init();
                a.options.$loginFlag.data("nick", "");
                a.options.$loginFlag.data("userPic", "");
                this.bindReportEvent();
                this.bindFooterEvent(this.options.$content);
                this.makeCommentList();
                this.onScriptLoad();
                this.element.bind(this.options.loginEvent, function(b, d, e, h) {
                    a.onLogined(d, e, h)
                });
                this.element.bind(this.options.pubSucEvent, function(b, d) {
                    a.insertTempComment(d.data.commentid, d.data.content, d.data.parent, d.data.time, d.data.checktype);
                    a.updateTime()
                });
                this.initPostFrame()
            },
            init: function() {
                var c = this.options;
                a(top.document).find("#commentIframe").css({
                    "-webkit-transition-property": "height",
                    "-webkit-transition-duration": "0.6s,0.6s,0.6s"
                });
                a("#mainBody").css("width",
                    "100%");
                c.commentNumbers = a(parent.document).find(".commentNumbers") ? a(parent.document).find(".commentNumbers") : "";
                a("#allComments .post-list").length || a("#allComments").append('<div id="warp" class="warp"><ul class="post-list" id="row1"></ul><ul class="post-list" id="row2"></ul><ul class="post-list last" id="row3"></ul></div>');
                a("a").each(function() {
                    a(this).attr("hideFocus", "true")
                });
                if (parent.registerCoralEvent) {
                    parent.registerCoralEvent.source && (c.columSource = parent.registerCoralEvent.source);
                    if (0 == parent.registerCoralEvent.code || 1 == parent.registerCoralEvent.code) c.columCode = parent.registerCoralEvent.code;
                    parent.registerCoralEvent.ownStyle && a("head").append('<link href="' + parent.registerCoralEvent.ownStyle + '" rel="stylesheet" type="text/css" media="screen"/>');
                    parent.registerCoralEvent.listHiden && (a("#content").hide(), c.columApi = 0, a(parent.document).find("#commentIframe").height(130));
                    parent.registerCoralEvent.commentNums && (c.homePageSize = parent.registerCoralEvent.commentNums);
                    0 == parent.registerCoralEvent.commentLink &&
                        (c.columLink = parent.registerCoralEvent.commentLink);
                    2 == parent.registerCoralEvent.commentLink && (c.columLink = parent.registerCoralEvent.commentLink);
                    0 == parent.registerCoralEvent.commentHot && (c.columHot = parent.registerCoralEvent.commentHot);
                    if (top.location.host.match("coral.qq.com")) {
                        var b = top.location.host;
                        null != b.match(/(\w+)\.coral\.qq\.com/) && (c.fetchUrl = "http://" + b.match(/(\w+)\.coral\.qq\.com/)[1] + ".coral.qq.com/")
                    } else void 0 != parent.registerCoralEvent.site && (c.fetchUrl = "http://" + parent.registerCoralEvent.site +
                        ".coral.qq.com/")
                }
            },
            getParentId: function(c) {
                return a(document.getElementById("commentIframe").contentWindow.document.getElementById(c))
            },
            getIframeId: function(c, b) {
                return a(document.getElementById(c).contentWindow.document.getElementById(b))
            },
            createHtml: function(c, b, d, e, h) {
                e = c.userinfo.head ? c.userinfo.head : "http://mat1.gtimg.com/news/dc/images/user.png";
                var l = c.userinfo.nick,
                    g = c.content.replace(/\n/g, "<br />"),
                    p = 560 < g.realLength ? "286px" : "auto";
                c.userinfo.region.replace(/:/g, " ");
                b = b ? b : "";
                var f = "comment_";
                "msg" == d && (f = "msg_");
                "top" == d && (f = "top_");
                0 < c.hotscale || a.cookie("uid");
                d = "";
                2 < h && (b = "undis");
                if ("" != g) return d = 2 != c.checkstatus || c.rep ? d + ("<li class='post " + b + "  ' id=" + f + c.id + " tid=" + c.targetid + "><div class='post-content'><div class='indicator'></div><div class='avatar popClick' post_uid = '" + c.userinfo.userid + "'><span><img src='" + e + "'/></span></div><div class='post-body'><div class='post-title'></div><div class='post-message-container' style='overflow:hidden;height:" + p + ";'><div><span class='headImg popClick' post_uid = '" +
                    c.userinfo.userid + "'><img src='" + e + "'/></span> <span  post_uid = " + c.userinfo.userid + " class='publisher popClick'>" + l + "</span>\uff1a<em>\u201c</em>" + g + "<em>\u201d</em><a class='np-postlink' targetid='" + c.targetid + "' commentid='" + c.id + "' parentid='" + c.parent + "' href='javascript:void(0)'><img src='http://mat1.gtimg.com/www/niuping2013/postframe/transparent.gif'/></a><span date=" + c.time + " class='uptime'>" + this.formatTime(c.time) + "</span></div></div><div class='post-footer'><em class='newcoment' id=em_" +
                    c.id + "></em><span class='upvote'><a href='javascript:void(0)'><i>\u9876</i>(<em>" + c.up + "</em>)</a></span><span>" + this.creatPostLink(c) + "</span></div></div></div><ul class='children'></ul></li>") : d + ("<li class='postHide ' id=" + f + c.id + "><ul class='children'></ul></li>")
            },
            creatPostLink: function(a) {
                return "<a class='np-postlink replyy' targetid='" + a.targetid + "' commentid='" + a.id + "' parentid='" + a.parent + "' href='javascript:void(0)'><img src='http://mat1.gtimg.com/www/niuping2013/postframe/transparent.gif' />\u56de\u590d(" +
                    a.rep + ")</a>"
            },
            loadCommentNum: function() {},
            makeCommentList: function() {
                var c = this,
                    b = this.options;
                b.columApi && c.loadMore();
                b.$loadMore.find("span").unbind().bind("click", function() {
                    a("#loadMore>span").hide();
                    a("#loadMore>em").css("display", "block").html("\u52a0\u8f7d\u4e2d...");
                    c.loadMore(b.lastId);
                    0 >= b.$loadMore.data("loadMoreNume") - b.homePageSize ? (b.$loadMore.hide(), b.$loadMore.data("loadMoreNume", 0)) : b.$loadMore.data("loadMoreNume", b.$loadMore.data("loadMoreNume") - b.homePageSize)
                });
                a(window).bind("scroll",
                    function() {
                        if (1 == b.scrollFlag) {
                            b.scrollFlag = 0;
                            var c = a(document).height(),
                                e = a(window).scrollTop(),
                                h = a(window).height();
                            e + h > c - 800 && "none" == a("#loadMore>em").css("display") && a("#loadMore span").click()
                        }
                        0 == b.scrollFlag && (b.timer = setTimeout(function() {
                            b.scrollFlag = 1
                        }, 500))
                    })
            },
            hotList: function() {},
            tabsComment: function() {},
            refreshFn: function() {
                this.loadMore(0, 0, 1)
            },
            loadNewComment: function(c, b) {
                var d = this,
                    e = this.options;
                c = c || 0;
                var h = b.split("_")[2];
                a.ajax({
                    url: e.fetchUrl + "article/" + h + "/comment?commentid=" +
                        c + "&reqnum=5",
                    dataType: "jsonp",
                    jsonpCallback: "mainComment",
                    success: function(c) {
                        0 == c.errCode && a.each(c.data.commentid, function(c, e) {
                            a("#" + b + ">ul").append(d.createHtml(e))
                        })
                    }
                })
            },
            loadMore: function(c, b, d) {
                function e() {
                    0 == a("#allComments li").length && a("#allComments").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show()
                }
                var h = this,
                    l = this.options;
                c = c || 0;
                1 == d && (c = 0);
                b = "http://coral.qq.com/home/comment?lastid=" + c + "&reqnum=20";
                "\u6ca1\u6709\u66f4\u591a\u4e86" != a("#loadMore>em").html() &&
                    a.ajax({
                        url: b,
                        dataType: "jsonp",
                        beforeSend: function() {
                            h._latestTimer0 = (new Date).getTime()
                        },
                        error: e,
                        jsonpCallback: "mainComment",
                        success: function(b) {
                            if (0 == b.errCode) {
                                var d = (new Date).getTime();
                                l.lastId = b.data.last;
                                b.data.retnum < b.data.reqnum || b.data.total <= l.homePageSize ? (a("#loadMore>span").hide(), a("#loadMore>em").css("display", "block").html("\u6ca1\u6709\u66f4\u591a\u4e86")) : (a("#loadMore").show(), a("#loadMore>em").hide(), a("#loadMore>span").css("display", "block"));
                                f(b);
                                c || b.data.reqnum < b.data.total &&
                                    0 < a("#allComments li").length && l.$loadMore.show()
                            } else e();
                            0 == a("#allComments li").length && a("#loadMore").hide();
                            Qoss("zxpl", h._latestTimer0, {
                                1: h._latestTimer0 + 1,
                                2: d,
                                3: d
                            }, 100)
                        }
                    });
                var f = function(c) {
                    c.data.targetlist.length || 0 != a("#allComments li").length ? a("#allComments").children(".tipInfo").hide() : (a("#allComments").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show(), a("#loadMore").hide());
                    a("#allComments .post-list").length || a("#allComments").append("<ul class='post-list'></ul>");
                    var b = [a("#row1"), a("#row2"), a("#row3")],
                        d = [];
                    getRowByHeight = function() {
                        for (var a = 0; b[a]; a++) d.push(b[a]);
                        d.sort(function(a, c) {
                            return a.height() - c.height()
                        });
                        return d
                    };
                    var e = getRowByHeight(),
                        f = "";
                    a.each(c.data.targetlist, function(c, b) {
                        l.targetNum++;
                        e = getRowByHeight();
                        if (b.commentlist.length) {
                            if (b.imgurl && !parseInt(l.noImg)) {
                                var d = "";
                                b.imgurl.indexOf("?") && (d = b.imgurl.split("?")[1]);
                                f = '<a href="' + b.url + '" target="_blank"><img width="320" height="' + d + '" src="' + b.imgurl + '" /></a>'
                            } else f = "";
                            d = "la1";
                            100 < b.commentnum && (d = "la2");
                            1E3 < b.commentnum && (d = "la3");
                            1E4 < b.commentnum && (d = "la4");
                            e[0].append('<li class="targetinfo "  id="target_' + l.targetNum + "_" + b.targetid + '"><div class="post-title">' + f + '<div class="tit"><a target="_blank" href="' + b.url + '">' + b.title + '</a><a class="num ' + d + '" target="_blank" href="http://coral.qq.com/' + b.targetid + '">' + b.commentnum + ' \u6761\u8bc4\u8bba</a></div></div><ul class="targetpost"></ul></li>');
                            var g = 0;
                            a.each(b.commentlist, function(c, d) {
                                d.id && (g++, a("#target_" + l.targetNum +
                                    "_" + b.targetid + ">ul").append(h.createHtml(d, void 0, void 0, b.targetid, c)), 2 == c && 3 < b.commentlist.length && a("#target_" + l.targetNum + "_" + b.targetid + ">ul").append('<li class="loadtarget"><span>\u66f4\u591a</span></li>'))
                            })
                        }
                    });
                    h.conHeight()
                }
            },
            blueLine: function(c) {
                setTimeout(function() {
                    a(c + ">.post-content>.indicator").animate({
                        opacity: "0"
                    }, 1E4);
                    setTimeout(function() {
                            a(c + ">.post-content>.avatar").animate({
                                left: "0px"
                            }, 400);
                            a(c + ">.post-content>.post-body").animate({
                                "padding-left": "0px"
                            }, 400);
                            a(c).removeClass("blueflag")
                        },
                        8E3)
                }, 5E3)
            },
            probeEvent: function() {},
            loadNew: function() {},
            changeTab: function() {},
            loadNum: function() {},
            bindFooterEvent: function(c) {
                var b = this,
                    d = this.options;
                a(".pop_reply");
                a(".pop_reply a.submit");
                a(".pop_reply textarea");
                c.delegate(".reply", "click", function(a) {});
                c.delegate(".pop_reply", "click", function(a) {
                    a.stopPropagation()
                });
                c.delegate(".submit", "click", function() {
                    var c = b.getLoginStatus(),
                        h = a(this).closest("[tid]").attr("tid");
                    d.replylistId = a(this).attr("id").split("_")[2];
                    0 != c ? (b.checkAndPublish(this.id,
                        h), d.$insertFlag = this.id.split("_")[1]) : b.showLoginLayer()
                });
                c.delegate(".pop_user_login", "click", function() {
                    b.showLoginLayer()
                });
                c.delegate(".upvote", "click", function() {
                    var b = a(this).parent(".post-footer").children("em.newcoment").attr("id").split("_")[1];
                    d.uptId = a(this).parent(".post-footer").children(".newcoment").attr("id");
                    if (a(this).find("a").hasClass("hasup") || a(this).find("span").hasClass("hasup")) return !1;
                    if (a.cookie("uid") == a(this).parent().parent().prev(".avatar").attr("post_uid")) return alert("\u81ea\u5df1\u4e0d\u80fd\u9876\u81ea\u5df1"), !1;
                    var c = a(this).parents(".post").attr("tid");
                    a.ajax({
                        url: d.wfetchUrl + "article/comment/up/to/" + b + "?targetid=" + c,
                        dataType: "jsonp",
                        cache: !0,
                        jsonpCallback: "upvote",
                        beforeSend: function() {},
                        success: function(a) {
                            sendClientStat(n, 1, c, "pub_up")
                        }
                    });
                    var b = a(this).find("em"),
                        l = parseInt(b.text());
                    b.html(l + 1);
                    a(this).find("a").addClass("hasup");
                    a(this).find("span").addClass("hasup");
                    a(this).find("i").html("\u5df2\u9876")
                });
                c.delegate(".popClick", "click", function() {
                    a(this).attr("post_uid");
                    var c = a(this).attr("post_uid"),
                        h = a(this).parents(".post").attr("tid");
                    d.$urlapi_userComment.msgid = "";
                    b.popupIframeLayer(c);
                    sendClientStat(n, 1, h, "clk_head")
                });
                c.delegate(".newcoment", "click", function() {
                    var c = a(this).attr("id").split("_")[1],
                        d = a(this).parents(".post").attr("tid");
                    a("#comment_" + c + ">ul.children li .newcoment").hide();
                    a("#comment_" + c + ">ul.children li.undis").removeClass("undis").addClass("blueflag");
                    b.iframeHeight();
                    a(this).hide();
                    a("#comment_" + c).data("num", 0);
                    a("#comment_" + c + ">ul.children li.blueflag").each(function(c,
                        d) {
                        b.blueLine("#" + a(this).attr("id"))
                    });
                    sendClientStat(n, 1, d, "clk_newreply_notice")
                });
                c.delegate(".spreadMoreBtn", "click", function() {
                    a(this).prev().css("height", "");
                    a(this).hide();
                    b.iframeHeight()
                });
                c.delegate(".loadtarget", "click", function() {
                    a(this).nextAll("li").removeClass("undis");
                    a(this).hide()
                });
                c.delegate(".loadNewComment", "click", function() {
                    b.loadNewComment(0, a(this).closest(".targetinfo").attr("id"));
                    a(this).hide()
                })
            },
            showLoginLayer: function() {
                publicLoginEvent()
            },
            onLogined: function(c, b, d) {
                m =
                    ("" + c).match(/[1-9][0-9]*/)[0] || getUin();
                a("#my-message .tipInfo").show();
                this.options.$loginFlag.data("userPic", d);
                this.options.$loginFlag.data("nick", b);
                a("#np-pop-iframe").length && a(this.getIframeId("np-pop-iframe", "pop_user_login")).hide()
            },
            loginOut2: function(c) {
                m = null;
                c || this.options.$logoutTrigger.click();
                a.removeCookie("uid");
                this.options.$loginFlag.data("userPic", "");
                this.options.$loginFlag.data("nick", "")
            },
            getLoginStatus: function() {
                if (m != getUin()) try {
                    this.loginOut2()
                } catch (a) {}
                return m ? 1 :
                    0
            },
            bindSubmitEvent: function() {
                var a = this,
                    b = this.options;
                b.$postBtns.unbind().click(function() {
                    a.checkAndPublish(this.id);
                    b.$insertFlag = "comment"
                })
            },
            bindReportEvent: function() {
                var c = this,
                    b = this.options;
                a("#mainBody").delegate(".report", "click", function() {
                    if (0 != c.getLoginStatus()) {
                        if (a.cookie("uid") == a(this).next(".publisher").attr("post_uid")) return a(this).find("em").length || (a(this).append("<em>\u81ea\u5df1\u4e0d\u80fd\u4e3e\u62a5\u81ea\u5df1</em>"), a(this).addClass("reportOn")), !1;
                        a(this).find("em").length ||
                            (b.reportId = a(this).attr("id"), c.postData(a(this).attr("id"), a(this).closest("[tid]").attr("tid")))
                    } else c.showLoginLayer()
                });
                a("#mainBody").delegate(".post", "mouseover", function(b) {
                    a(this).find(".report:first").show();
                    b.stopPropagation()
                });
                a("#mainBody").delegate(".post", "mouseout", function(b) {
                    a(this).find(".report em").length || a(this).find(".report:first").hide();
                    b.stopPropagation()
                })
            },
            reportInit: function() {
                var c = this.options.$allComments.find("li.post .reportOn");
                a.each(c, function(b, c) {
                    a(this).removeClass("reportOn");
                    a(this).find("em").remove()
                })
            },
            checkAndPublish: function(c, b) {
                var d = this.options,
                    e = c.replace(/pop/, "pop_text"),
                    e = a("#" + e),
                    h = c.split("_")[0];
                "top" == h && (e = d.$topContent, sendClientStat(n, 1, b, "pub_original"));
                0 == a.trim(e.val()).length || e.val() == d.topContentTips ? this.pubCallback(c, {
                    ret: 1,
                    error2show: "\u8bf7\u8f93\u5165\u5185\u5bb9\uff01"
                }) : 2E3 < a.trim(e.val()).realLength() ? alert("\u8d85\u8fc71000\u4e2a\u5b57\u4e86") : getUin() ? ("top" == h && (a("#top_post_btn_load").show(), a("#top_post_btn").hide()), this.postData(c,
                    b)) : this.showLoginLayer()
            },
            postData: function(c, b) {
                var d = this.options;
                this._pubTimer0 = (new Date).getTime();
                var e = generateToken(getKey()),
                    h = c.replace(/pop/, "pop_text"),
                    l = c.split("_")[2],
                    f = c.split("_")[0],
                    g = c.split("_")[2];
                c.split("_");
                "pop" == f ? (a("#" + c).html("").removeClass("submit").addClass("submitOn"), this.submitForm({
                    targetid: b,
                    type: 1,
                    format: "SCRIPT",
                    callback: d.popCallback,
                    content: a.trim(a("#" + h).val()),
                    _method: "put",
                    g_tk: e,
                    code: 1,
                    source: d.columSource
                }, l)) : "report" == f && this.submitForm({
                    targetid: b,
                    _method: "put",
                    commentid: g,
                    format: "SCRIPT",
                    g_tk: e,
                    callback: d.reportCallback
                }, f)
            },
            submitForm: function(c, b) {
                var d = this.options,
                    e = "",
                    e = b ? "report" == b || "msg" == b ? "http://w.coral.qq.com/report/comment/0" : "em" == b.split("_")[0] || "am" == b.split("_")[0] ? d.wfetchUrl + "article/comment/up/to/" + b.split("_")[1] : d.wfetchUrl + "article/comment/to/" + b : d.wfetchUrl + "article/comment/";
                a("#post_iframe").length || k.append('<iframe id="post_iframe" name="post_iframe" style="display:none"><script type="text/javascript">document.domain = "qq.com";\x3c/script></iframe>');
                d = a("#_messageform").length ? a("#_messageform").attr("action", e).empty() : a('<form action="' + e + '" method="post" target="post_iframe" id="_messageform" style="display:none;"></form>').appendTo(k);
                for (name in c) d.append(a('<input name="' + name + '" type="hidden" value="" />').val(c[name]));
                d.submit()
            },
            sendStat: function(a) {},
            pubCallback: function(c, b, d) {
                var e = c.split("_")[0],
                    h = this.options;
                d = "\u8bc4\u8bba\u6210\u529f!";
                if ("pop" == e) {
                    var e = c.replace(/pop_/, ""),
                        f = a("#" + e + ">.children .tips"),
                        g = a("#content").find(".pop_reply:visible .tips"),
                        p = a("#content").find(".pop_reply:visible textarea"),
                        m = c.replace(/pop/, "pop_text");
                    if (b.ret) tips = b.error2show || "<b>\u56e7</b>... \u51fa\u9519\u4e86\uff01 ", f.html(tips).hide().fadeIn("slow"), setTimeout(function() {
                        a("#" + m).focus();
                        f.html("")
                    }, 2E3);
                    else {
                        c = {
                            data: {
                                parent: h.replylistId,
                                commentid: "222",
                                time: "\u521a\u521a",
                                content: a(p).val(),
                                checktype: "0"
                            }
                        };
                        switch (b.errCode) {
                            case 0:
                                this._trigger("pubsuccess", null, b);
                                break;
                            case 8:
                                this.showLoginLayer();
                                break;
                            case 9:
                            case 13:
                            case 14:
                            case 16:
                            case 17:
                                this._trigger("pubsuccess",
                                    null, c);
                                break;
                            default:
                                d = "\u7cfb\u7edf\u51fa\u9519\u8bf7\u7a0d\u540e\u518d\u53d1"
                        }
                        g.html(d).hide().fadeIn("slow");
                        a("#content").find(".pop_reply:visible .replyBtn a").removeClass("submitOn").addClass("submit").html("\u56de\u590d");
                        setTimeout(function() {
                            a(p).focus();
                            g.html("")
                        }, 2E3)
                    }
                } else "report" == e && (0 == b.errCode ? (a("#report_comment_" + b.data.commentid).append("<em>24\u5c0f\u65f6\u5185\u7ed9\u60a8\u53cd\u9988\uff0c\u89c1\u6211\u7684\u725b\u8bc4</em>"), a("#report_top_" + b.data.commentid).append("<em>24\u5c0f\u65f6\u5185\u7ed9\u60a8\u53cd\u9988\uff0c\u89c1\u6211\u7684\u725b\u8bc4</em>"),
                    a("#msg_report_" + b.data.commentid).append("<em>24\u5c0f\u65f6\u5185\u7ed9\u60a8\u53cd\u9988\uff0c\u89c1\u6211\u7684\u725b\u8bc4</em>")) : 12 == b.errCode ? a("#" + h.reportId).append("<em>\u60a8\u4eca\u5929\u4e3e\u62a5\u7684\u6761\u6570\u5df2\u8fbe\u4e0a\u9650</em>") : a("#" + h.reportId).append("<em>\u8be5\u8bc4\u8bba\u5df2\u88ab\u4e3e\u62a5\u6216\u5904\u7406!</em>"), a("#" + h.reportId).addClass("reportOn"))
            },
            insertTempComment: function(c, b, d, e, h) {
                var f = this.options;
                m || getUin();
                var g = f.$loginFlag.find(".myName").html(),
                    p = f.$loginFlag.find("img").attr("src"),
                    k = "";
                1 == h ? (b = {
                        id: c,
                        parent: 0,
                        time: e,
                        content: b,
                        up: 0,
                        userinfo: {
                            userid: a.cookie("uid"),
                            commentnum: "",
                            upnum: 0,
                            nick: g,
                            head: p,
                            region: ""
                        }
                    }, k = this.createHtml(b, "blueflag", f.$insertFlag)) : k = "<li class='post temporary blueflag' id=comment_" + c + "><div class='post-title'><div class='indicator'></div></div><div class='post-message-container'>" + b + "<div class='avatar'><span><img src='" + p + "'/></span></div><div class='post-body'><div class='post-header'><span class='publisher'><span>" +
                    g + "</span></span><span class='uptime0'>\u521a\u521a</span><span class='wait'></span></div><div class='post-footer' style='height:5px'><em></em></div></div></div><ul class='children'></ul></li>";
                if (0 != parseInt(d)) {
                    if (a("#top_" + d).length || a("#comment_" + d).length || a("#post_" + d).length || a("#msg_" + d).length) a("#top_" + d + ">ul.children").prepend(k).children("div.pop_reply").hide(), a("#comment_" + d + ">ul.children").prepend(k).children("div.pop_reply").hide(), a("#post_" + d + ">ul.children").children("div.pop_reply").hide(),
                        a("#msg_" + d + ">ul.children").prepend(k).children("div.pop_reply").hide(), this.iframeHeight()
                } else a("#allComments .tipInfo:visible") && a("#allComments .tipInfo").hide(), this.options.$allComments.children("ul.post-list").prepend(k);
                "post" != f.$insertFlag ? this.blueLine("#" + f.$insertFlag + "_" + c) : this.blueLine("#comment_" + c)
            },
            popUploadMore: function(a, b) {
                var d = this.options;
                d.$urlapi_userComment.pageflag = 1;
                d.$urlapi_userComment.msgid = d.$urlapi_userComment.last;
                this.loadUserComment(a, b)
            },
            popupLayer: function(c) {
                var b =
                    this.options,
                    d = g.height() > f.height() ? g.height() : f.height();
                if (b.$urlapi_userComment.userId = c.uid) a("#popInfo").html(""), this.loadUserComment();
                a("#loadPopInfo").hide();
                a("#loadPopInfo>span").css("display", "block");
                a("#popObj .userPic").find("img").attr("src", "http://mat1.gtimg.com/news/dc/images/user.png");
                a("#parent").hide();
                a("#div1").css("top", "0px");
                a("#div3").css("top", "0px");
                var e = function() {
                    a("#popContent").height(b.$popObj.height() - 120);
                    a("#popContent .popInner").height(b.$popObj.height() -
                        140);
                    a("#div2").height(a("#popContent .popInner").height());
                    a("#parent").height(a("#popContent .popInner").height());
                    a("#div1").css("height", a("#parent").height() * a("#div2").height() / a("#div3").height());
                    a("#div1").css("top", "0px");
                    a("#div3").css("top", "0px")
                };
                !a.browser.msie || "6.0" != a.browser.version && "7.0" != a.browser.version || a.support.style || (b.$popObj.css("top", f.scrollTop() + .1 * f.height()), b.$popObj.css("top") > f.height() && b.$popObj.hide(), 780 > b.$popObj.height() ? b.$popObj.height(.8 * f.height()) :
                    b.$popObj.height(780), a("#popContent").height(.8 * f.height() - 120), f.resize(function() {
                        b.$popObj.height(.8 * f.height())
                    }), f.scroll(function() {
                        b.$popObj.css("top", f.scrollTop() + .1 * f.height())
                    }), e());
                e();
                f.resize(function() {
                    e()
                });
                var h = function() {
                    a.browser.msie && "6.0" == a.browser.version && !a.support.style ? b.$popObj.stop().animate({
                        top: f.scrollTop() + f.height()
                    }, 300).show() : b.$popObj.stop().animate({
                        top: "100%"
                    }, 300);
                    k.css("overflow", "");
                    a("html").css("overflow", "auto");
                    setTimeout(function() {
                            b.$popObj.hide()
                        },
                        301);
                    a("#maskObj").hide();
                    a("#loadPopInfo").hide()
                };
                k.css("overflow", "hidden");
                a("html").css("overflow", "hidden");
                a("#maskObj").height(d).show();
                a.browser.msie && "6.0" == a.browser.version && !a.support.style ? b.$popObj.stop().animate({
                    top: f.scrollTop() + .1 * f.height()
                }, 300).show() : b.$popObj.stop().animate({
                    top: "10%"
                }, 300).show();
                a("#maskObj").unbind().click(function() {
                    h()
                });
                b.$popObj.find(".close").unbind().click(function() {
                    h()
                });
                this.popScroll()
            },
            popScroll: function() {
                function c(a) {
                    a = a || window.event;
                    var c = !0,
                        c = a.wheelDelta ? 0 > a.wheelDelta : 0 < a.detail,
                        g = 0;
                    if (c)
                        if (e.height() > d.height()) g = e.position().top - 20;
                        else return;
                    else if (e.height() > d.height()) g = e.position().top + 20;
                    else return;
                    c = g;
                    0 > -c ? c = 0 : -c > e.height() - d.height() && (c = -(e.height() - d.height()));
                    e.css("top", c);
                    c = -c / (e.height() - d.height());
                    b.css("top", (f.height() - b.height()) * c);
                    a.preventDefault && a.preventDefault()
                }
                var b = a("#div1"),
                    d = a("#div2"),
                    e = a("#div3"),
                    f = a("#parent");
                f.bind("mousewheel", function() {
                    c()
                });
                f.bind("DOMMouseScroll", function() {
                    c()
                });
                e.bind("mousewheel",
                    function() {
                        c()
                    });
                e.bind("DOMMouseScroll", function() {
                    c()
                });
                b.bind("mousedown", function(a) {
                    a = a || window.event;
                    var c = a.clientY - b.position().top;
                    g.bind("mousemove", function(a) {
                        a = a || window.event;
                        a = a.clientY - c;
                        0 > a ? a = 0 : a > f.height() - b.height() && (a = f.height() - b.height());
                        b.css("top", a);
                        a /= f.height() - b.height();
                        e.css("top", -(e.height() - d.height()) * a)
                    });
                    g.bind("mouseup", function(a) {
                        g.unbind("mousemove");
                        g.unbind("mouseup")
                    });
                    g.bind("selectstart", function(a) {
                        return !1
                    })
                });
                g.bind("mouseup", function(a) {
                    g.unbind("selectstart")
                })
            },
            onScriptLoad: function() {
                var a = this;
                if (top.loginAll && "function" == typeof top.loginAll) var b = top.loginAll;
                top.loginAll = function(d) {
                    if (b && "function" == typeof b && (b(d), 0 == d.result)) {
                        var e = d.Face;
                        d = d.nick;
                        var f = f || getUin(),
                            g = getKey();
                        if (f && g) a.onLogined(f, d, e)
                    }
                }
            },
            bindOtherEvents: function() {
                var c = this,
                    b = this.options;
                b.$topContent.val(b.topContentTips);
                a("#top_post_btn_login").unbind().bind("click", function() {
                    c.showLoginLayer()
                })
            },
            formatTime: function(a) {
                var b = this.options.$nowDate / 1E3 - a;
                if (1 > b) return "\u521a\u521a";
                if (60 > b) return Math.floor(b) + "\u79d2\u949f\u524d";
                if (3600 > b) return Math.floor(b / 60) + "\u5206\u949f\u524d";
                if (86400 > b) return Math.floor(b / 3600) + "\u5c0f\u65f6\u524d";
                if (604800 > b) return Math.floor(b / 86400) + "\u5929\u524d";
                a = new Date(1E3 * a);
                b = a.getFullYear() + "-";
                b += a.getMonth() + 1 + "-";
                return b += a.getDate()
            },
            conHeight: function(c) {
                c = a("#allComments .post .post-message-container");
                var b = 24;
                c.length && (b = c.css("line-height").split("px")[0], c.each(function(c, e) {
                    a(this).height() > 15 * b && !a(this).next(".spreadMoreBtn").length &&
                        (a(this).css({
                            height: 12 * b,
                            overflow: "hidden"
                        }), a(this).after('<div class="spreadMoreBtn"><span>\u5c55\u5f00</span></div>'))
                }))
            },
            updateTime: function() {
                var c = this;
                this.options.$content.find(".uptime").each(function() {
                    a(this).html(c.formatTime(a(this).attr("date")))
                })
            },
            subString: function(a, b) {
                var d = /[^\x00-\xff]/g;
                if (a.replace(d, "mm").length <= b) return a;
                for (var e = Math.floor(b / 2); e < a.length; e++)
                    if (a.substr(0, e).replace(d, "mm").length >= b) return a.substr(0, e) + "...";
                return a
            },
            myCreateHmtl: function(a, b, d) {},
            loadMyMessage: function() {},
            loadMyComment: function() {},
            loadUserComment: function(a, b) {},
            clickLoadMore: function() {},
            popupIframeLayer: function(c) {
                a(top.document.body).append('<iframe src ="http://www.qq.com/coral/coralBeta2/coralPopDom2.0.htm" allowTransparency="true"  frameborder="0" scrolling="no" style="width:100%;height:100%;z-index:999999;position:fixed;_position:absolute;*+position:fixed;_left:100px;top:0px;left:0px;border:none;overflow:hidden;" id="np-pop-iframe" data-id = ' + c + "></iframe>");
                a.browser.msie &&
                    "6.0" == a.browser.version && !a.support.style && 0 != a(top.document.body).find("#np-pop-iframe").length && a(top.document.body).find("#np-pop-iframe").css("position", "absolute")
            },
            initPostFrame: function() {
                var c = this;
                a("#content").delegate(".np-postlink", "click", function(b) {
                    b = c.options.$loginFlag.data("nick");
                    var d = c.options.$loginFlag.data("userPic"),
                        e = a(this),
                        f = e.attr("targetid"),
                        g = e.attr("commentid"),
                        e = e.attr("parentid");
                    a(document.body).append('<iframe src="" id="np-pop-iframe" allowtransparency="true" frameborder="0" scrolling="no" style="width: 100%; z-index: 999999998; position: fixed; _position:absolute; top: 0px; left: 0px; border: none; overflow: hidden; height: 100%;" data-text="on"  data-nick="' +
                        b + '" data-pic="' + d + '" data-id="' + f + "_" + g + '" parentid="' + e + '"></iframe>');
                    a("#np-pop-iframe").attr("src", "http://www.qq.com/coral/postframe/postframe2.0.htm")
                })
            }
        });
        g.comment()
    })(jQuery)
});
String.prototype.realLength = function() {
    return this.replace(/[^\x00-\xff]/g, "**").length
};

function topCallback(a) {
    jQuery(document).comment("pubCallback", "top", a, (new Date).getTime())
}

function popCallback(a) {
    jQuery(document).comment("pubCallback", "pop", a, (new Date).getTime())
}

function reportCallback(a) {
    jQuery(document).comment("pubCallback", "report", a, (new Date).getTime())
}

function upCallback(a) {
    jQuery(document).comment("pubCallback", "up", a, (new Date).getTime())
}

function getUin() {
    var a = jQuery.cookie("uin");
    return a && a.match(/[1-9][0-9]*/)[0]
}

function getKey() {
    return jQuery.cookie("skey") || jQuery.cookie("lskey")
}

function generateToken(a) {
    var g = 2013;
    if (a)
        for (var f = 0, k = a.length; f < k; f++) g += (g << 5) + a.charCodeAt(f);
    return g & 2147483647
}

function publicLoginEvent() {
    registerCoralEvent && registerCoralEvent.loginEvent ? registerCoralEvent.loginEvent() : jQuery(parent.document.getElementById("onekey")).click()
}

function publicLogined(a, g, f) {
    a && (jQuery(document).comment("onLogined", a, g, f), jQuery("#np-pop-iframe").length && document.getElementById("np-pop-iframe").contentWindow.publicLogined(a, g, f))
}

function publicLogout() {
    jQuery(document).comment("loginOut2")
}

function popupContent(a) {
    jQuery(document).comment("loadUserComment", a)
}

function clickLoadMroe(a, g) {
    jQuery(document).comment("popUploadMore", a, g)
}

function Qoss(a, g, f, k) {
    if (!k || !parseInt(Math.random() * k)) {
        for (var m in f) f[m] -= g;
        jQuery('<img src="http://qos.report.qq.com/collect?type=1&name=coral_qq_com_' + a + "&" + jQuery.param(f) + '">').error(function() {
            jQuery(this).remove()
        }).load(function() {
            jQuery(this).remove()
        }).appendTo("body")
    }
}

function sendClientStat(a, g, f, k, m) {
    var n = location.protocol + "//" + location.host + location.pathname,
        c = parseInt(1E9 * Math.random()),
        b = getUin() || "",
        d = jQuery.cookie("uid"),
        e = encodeURIComponent(location.host);
    if ("coral" == a)
        if (1 == g) {
            g = 1836;
            var h = "coral.web.comment_detail.action"
        } else g = 1837, h = "coral.web.comment_detail.pgv";
    else 1 == g ? (g = 1836, h = "coral.web.article_detail.action") : (g = 1837, h = "coral.web.article_detail.pgv");
    m = m || 0;
    g_btrace_BOSS = new Image(1, 1);
    g_btrace_BOSS.src = "http://btrace.qq.com/collect?sIp=0&iQQ=" +
        b + "&sBiz=" + h + "&sOp=" + k + "&iSta=" + m + "&iTy=" + g + "&iFlow=" + c + "&isite=" + a + "&iTargetid=" + f + "&iuid=" + d + "&iUrl=" + n + "&idomain=" + e
}; /*  |xGv00|b52487f4b4669bfb5d094e0988d382d4 */
